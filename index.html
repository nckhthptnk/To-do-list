<!DOCTYPE html>
<html lang="vi" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Th·ªùi Kh√≥a Bi·ªÉu T·ªëi Gi·∫£n</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        
        .schedule-cell {
            min-height: 80px;
            transition: all 0.2s ease;
        }
        
        .schedule-cell:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .note-cell {
            min-height: 60px;
            transition: all 0.2s ease;
        }
        
        .note-cell:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        input[type="text"], textarea {
            transition: all 0.2s ease;
        }
        
        input[type="text"]:focus, textarea:focus {
            transform: scale(1.02);
        }
        
        .btn {
            transition: all 0.2s ease;
        }
        
        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
    </style>
</head>
<body class="h-full bg-gray-50 font-sans">
    <div class="min-h-full p-4">
        <header class="text-center mb-6">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">üìÖ Th·ªùi Kh√≥a Bi·ªÉu</h1>
            <p class="text-gray-600">ƒê∆°n gi·∫£n & Hi·ªáu qu·∫£</p>
        </header>

        <div class="max-w-6xl mx-auto">
            <!-- N√∫t ƒëi·ªÅu khi·ªÉn -->
            <div class="flex justify-center gap-3 mb-6 flex-wrap">
                <button onclick="saveSchedule()" class="btn bg-green-400 hover:bg-green-500 text-white px-5 py-2 rounded-full font-medium shadow-md">
                    üíæ L∆∞u
                </button>
                <button onclick="exportAsImage()" class="btn bg-blue-400 hover:bg-blue-500 text-white px-5 py-2 rounded-full font-medium shadow-md">
                    üì∏ Xu·∫•t h√¨nh
                </button>
                <button onclick="toggleColorPalette()" class="btn bg-pink-400 hover:bg-pink-500 text-white px-5 py-2 rounded-full font-medium shadow-md">
                    üé® Ch·ªçn m√†u
                </button>
                <button onclick="downloadTemplate()" class="btn bg-purple-400 hover:bg-purple-500 text-white px-5 py-2 rounded-full font-medium shadow-md">
                    üìã T·∫£i m·∫´u Excel
                </button>
                <label for="excelFile" class="btn bg-orange-400 hover:bg-orange-500 text-white px-5 py-2 rounded-full font-medium shadow-md cursor-pointer">
                    üìÇ T·∫£i Excel l√™n
                </label>
                <input type="file" id="excelFile" accept=".xlsx,.xls" class="hidden" onchange="importFromExcel(event)">
                <button onclick="exportToExcel()" class="btn bg-teal-400 hover:bg-teal-500 text-white px-5 py-2 rounded-full font-medium shadow-md">
                    üìä Xu·∫•t Excel
                </button>
                <button onclick="clearSchedule()" class="btn bg-red-400 hover:bg-red-500 text-white px-5 py-2 rounded-full font-medium shadow-md">
                    üóëÔ∏è X√≥a
                </button>
            </div>

            <!-- B·∫£ng ch·ªçn m√†u pastel -->
            <div id="colorPalette" class="hidden bg-white rounded-2xl shadow-lg p-6 mb-6 border-2 border-gray-100">
                <div class="text-center mb-4">
                    <h3 class="text-lg font-bold text-gray-800 mb-2">üé® Ch·ªçn m√†u cho ti√™u ƒë·ªÅ</h3>
                    <p class="text-sm text-gray-600">Ch·ªçn m√†u cho d√≤ng ti√™u ƒë·ªÅ v√† c·ªôt th·ªùi gian</p>
                </div>
                
                <div class="grid grid-cols-3 gap-4 mb-4">
                    <div class="color-option" data-color="buttercup" onclick="selectColor('buttercup')">
                        <div class="w-16 h-16 rounded-xl cursor-pointer border-2 border-yellow-200 hover:border-yellow-300 transition-all duration-200 flex items-center justify-center" style="background: #fef3c7;">
                            <span class="text-xs font-medium text-yellow-800">Buttercup</span>
                        </div>
                    </div>
                    
                    <div class="color-option" data-color="softpeach" onclick="selectColor('softpeach')">
                        <div class="w-16 h-16 rounded-xl cursor-pointer border-2 border-orange-200 hover:border-orange-300 transition-all duration-200 flex items-center justify-center" style="background: #fed7d7;">
                            <span class="text-xs font-medium text-orange-800">Soft Peach</span>
                        </div>
                    </div>
                    
                    <div class="color-option" data-color="palepink" onclick="selectColor('palepink')">
                        <div class="w-16 h-16 rounded-xl cursor-pointer border-2 border-pink-200 hover:border-pink-300 transition-all duration-200 flex items-center justify-center" style="background: #fce7f3;">
                            <span class="text-xs font-medium text-pink-800">Pale Pink</span>
                        </div>
                    </div>
                    
                    <div class="color-option" data-color="lavender" onclick="selectColor('lavender')">
                        <div class="w-16 h-16 rounded-xl cursor-pointer border-2 border-purple-200 hover:border-purple-300 transition-all duration-200 flex items-center justify-center" style="background: #e9d5ff;">
                            <span class="text-xs font-medium text-purple-800">Lavender</span>
                        </div>
                    </div>
                    
                    <div class="color-option" data-color="coolaqua" onclick="selectColor('coolaqua')">
                        <div class="w-16 h-16 rounded-xl cursor-pointer border-2 border-cyan-200 hover:border-cyan-300 transition-all duration-200 flex items-center justify-center" style="background: #cffafe;">
                            <span class="text-xs font-medium text-cyan-800">Cool Aqua</span>
                        </div>
                    </div>
                    
                    <div class="color-option" data-color="meadowgreen" onclick="selectColor('meadowgreen')">
                        <div class="w-16 h-16 rounded-xl cursor-pointer border-2 border-green-200 hover:border-green-300 transition-all duration-200 flex items-center justify-center" style="background: #d1fae5;">
                            <span class="text-xs font-medium text-green-800">Meadow Green</span>
                        </div>
                    </div>
                </div>
                
                <div class="text-center">
                    <div id="selectedColorInfo" class="text-sm text-gray-600 mb-3">
                        Ch∆∞a ch·ªçn m√†u n√†o
                    </div>
                    <div class="flex justify-center gap-2 flex-wrap">
                        <button onclick="applyColorToHeaders()" class="bg-blue-400 hover:bg-blue-500 text-white px-4 py-2 rounded-full text-sm font-medium shadow-md transition-all duration-200">
                            üé® √Åp d·ª•ng cho ti√™u ƒë·ªÅ
                        </button>
                        <button onclick="applyColorToNotes()" class="bg-green-400 hover:bg-green-500 text-white px-4 py-2 rounded-full text-sm font-medium shadow-md transition-all duration-200">
                            üìù √Åp d·ª•ng cho ghi ch√∫
                        </button>
                        <button onclick="resetToDefault()" class="bg-gray-400 hover:bg-gray-500 text-white px-4 py-2 rounded-full text-sm font-medium shadow-md transition-all duration-200">
                            üîÑ V·ªÅ m·∫∑c ƒë·ªãnh
                        </button>
                    </div>
                </div>
            </div>

            <!-- Th√¥ng b√°o -->
            <div id="notification" class="hidden fixed top-4 right-4 bg-green-400 text-white px-4 py-2 rounded-full shadow-lg z-50">
                ƒê√£ l∆∞u! ‚ú®
            </div>

            <!-- B·∫£ng th·ªùi kh√≥a bi·ªÉu -->
            <div class="bg-white rounded-3xl shadow-lg overflow-hidden border-2 border-gray-100">
                <table class="w-full">
                    <thead>
                        <tr style="background: #d1fae5; color: #065f46;">
                            <th class="p-3 text-left font-bold">Th·ªùi Gian</th>
                            <th class="p-3 text-center font-bold">Th·ª© 2</th>
                            <th class="p-3 text-center font-bold">Th·ª© 3</th>
                            <th class="p-3 text-center font-bold">Th·ª© 4</th>
                            <th class="p-3 text-center font-bold">Th·ª© 5</th>
                            <th class="p-3 text-center font-bold">Th·ª© 6</th>
                            <th class="p-3 text-center font-bold">Th·ª© 7</th>
                        </tr>
                    </thead>
                    <tbody id="scheduleTable">
                        <!-- Bu·ªïi s√°ng -->
                        <tr class="bg-orange-200">
                            <td colspan="7" class="p-2 text-center font-bold text-gray-800">
                                üåÖ BU·ªîI S√ÅNG
                            </td>
                        </tr>
                        
                        <!-- Ti·∫øt 1 -->
                        <tr class="border-b border-gray-100">
                            <td style="background: #fef3c7; color: #92400e;" class="p-3 font-semibold text-center">
                                Ti·∫øt 1<br><span class="text-xs opacity-80">7:00-7:45</span>
                            </td>
                            <td class="schedule-cell p-2" data-period="morning-1" data-day="monday"></td>
                            <td class="schedule-cell p-2" data-period="morning-1" data-day="tuesday"></td>
                            <td class="schedule-cell p-2" data-period="morning-1" data-day="wednesday"></td>
                            <td class="schedule-cell p-2" data-period="morning-1" data-day="thursday"></td>
                            <td class="schedule-cell p-2" data-period="morning-1" data-day="friday"></td>
                            <td class="schedule-cell p-2" data-period="morning-1" data-day="saturday"></td>
                        </tr>
                        
                        <!-- Ghi ch√∫ sau ti·∫øt 1 -->
                        <tr style="background: #fefce8;">
                            <td style="background: #fef3c7; color: #92400e;" class="p-2 text-center text-xs font-medium">üìù Ghi ch√∫</td>
                            <td class="note-cell p-1" data-note="note-after-morning-1" data-day="monday"></td>
                            <td class="note-cell p-1" data-note="note-after-morning-1" data-day="tuesday"></td>
                            <td class="note-cell p-1" data-note="note-after-morning-1" data-day="wednesday"></td>
                            <td class="note-cell p-1" data-note="note-after-morning-1" data-day="thursday"></td>
                            <td class="note-cell p-1" data-note="note-after-morning-1" data-day="friday"></td>
                            <td class="note-cell p-1" data-note="note-after-morning-1" data-day="saturday"></td>
                        </tr>
                        
                        <!-- Ti·∫øt 2 -->
                        <tr class="border-b border-gray-100">
                            <td style="background: #fed7d7; color: #c2410c;" class="p-3 font-semibold text-center">
                                Ti·∫øt 2<br><span class="text-xs opacity-80">7:45-8:30</span>
                            </td>
                            <td class="schedule-cell p-2" data-period="morning-2" data-day="monday"></td>
                            <td class="schedule-cell p-2" data-period="morning-2" data-day="tuesday"></td>
                            <td class="schedule-cell p-2" data-period="morning-2" data-day="wednesday"></td>
                            <td class="schedule-cell p-2" data-period="morning-2" data-day="thursday"></td>
                            <td class="schedule-cell p-2" data-period="morning-2" data-day="friday"></td>
                            <td class="schedule-cell p-2" data-period="morning-2" data-day="saturday"></td>
                        </tr>
                        
                        <!-- Ghi ch√∫ sau ti·∫øt 2 -->
                        <tr style="background: #fef2f2;">
                            <td style="background: #fed7d7; color: #c2410c;" class="p-2 text-center text-xs font-medium">üìù Ghi ch√∫</td>
                            <td class="note-cell p-1" data-note="note-after-morning-2" data-day="monday"></td>
                            <td class="note-cell p-1" data-note="note-after-morning-2" data-day="tuesday"></td>
                            <td class="note-cell p-1" data-note="note-after-morning-2" data-day="wednesday"></td>
                            <td class="note-cell p-1" data-note="note-after-morning-2" data-day="thursday"></td>
                            <td class="note-cell p-1" data-note="note-after-morning-2" data-day="friday"></td>
                            <td class="note-cell p-1" data-note="note-after-morning-2" data-day="saturday"></td>
                        </tr>
                        

                        
                        <!-- Ti·∫øt 3 -->
                        <tr class="border-b border-gray-100">
                            <td style="background: #fce7f3; color: #be185d;" class="p-3 font-semibold text-center">
                                Ti·∫øt 3<br><span class="text-xs opacity-80">9:00-9:45</span>
                            </td>
                            <td class="schedule-cell p-2" data-period="morning-3" data-day="monday"></td>
                            <td class="schedule-cell p-2" data-period="morning-3" data-day="tuesday"></td>
                            <td class="schedule-cell p-2" data-period="morning-3" data-day="wednesday"></td>
                            <td class="schedule-cell p-2" data-period="morning-3" data-day="thursday"></td>
                            <td class="schedule-cell p-2" data-period="morning-3" data-day="friday"></td>
                            <td class="schedule-cell p-2" data-period="morning-3" data-day="saturday"></td>
                        </tr>
                        
                        <!-- Ghi ch√∫ sau ti·∫øt 3 -->
                        <tr style="background: #fdf2f8;">
                            <td style="background: #fce7f3; color: #be185d;" class="p-2 text-center text-xs font-medium">üìù Ghi ch√∫</td>
                            <td class="note-cell p-1" data-note="note-after-morning-3" data-day="monday"></td>
                            <td class="note-cell p-1" data-note="note-after-morning-3" data-day="tuesday"></td>
                            <td class="note-cell p-1" data-note="note-after-morning-3" data-day="wednesday"></td>
                            <td class="note-cell p-1" data-note="note-after-morning-3" data-day="thursday"></td>
                            <td class="note-cell p-1" data-note="note-after-morning-3" data-day="friday"></td>
                            <td class="note-cell p-1" data-note="note-after-morning-3" data-day="saturday"></td>
                        </tr>
                        
                        <!-- Ti·∫øt 4 -->
                        <tr class="border-b border-gray-100">
                            <td style="background: #e9d5ff; color: #6b21a8;" class="p-3 font-semibold text-center">
                                Ti·∫øt 4<br><span class="text-xs opacity-80">9:45-10:30</span>
                            </td>
                            <td class="schedule-cell p-2" data-period="morning-4" data-day="monday"></td>
                            <td class="schedule-cell p-2" data-period="morning-4" data-day="tuesday"></td>
                            <td class="schedule-cell p-2" data-period="morning-4" data-day="wednesday"></td>
                            <td class="schedule-cell p-2" data-period="morning-4" data-day="thursday"></td>
                            <td class="schedule-cell p-2" data-period="morning-4" data-day="friday"></td>
                            <td class="schedule-cell p-2" data-period="morning-4" data-day="saturday"></td>
                        </tr>
                        
                        <!-- Ghi ch√∫ sau ti·∫øt 4 -->
                        <tr style="background: #f3e8ff;">
                            <td style="background: #e9d5ff; color: #6b21a8;" class="p-2 text-center text-xs font-medium">üìù Ghi ch√∫</td>
                            <td class="note-cell p-1" data-note="note-after-morning-4" data-day="monday"></td>
                            <td class="note-cell p-1" data-note="note-after-morning-4" data-day="tuesday"></td>
                            <td class="note-cell p-1" data-note="note-after-morning-4" data-day="wednesday"></td>
                            <td class="note-cell p-1" data-note="note-after-morning-4" data-day="thursday"></td>
                            <td class="note-cell p-1" data-note="note-after-morning-4" data-day="friday"></td>
                            <td class="note-cell p-1" data-note="note-after-morning-4" data-day="saturday"></td>
                        </tr>
                        
                        <!-- Ti·∫øt 5 -->
                        <tr class="border-b border-gray-200">
                            <td style="background: #cffafe; color: #155e75;" class="p-3 font-semibold text-center">
                                Ti·∫øt 5<br><span class="text-xs opacity-80">10:30-11:15</span>
                            </td>
                            <td class="schedule-cell p-2" data-period="morning-5" data-day="monday"></td>
                            <td class="schedule-cell p-2" data-period="morning-5" data-day="tuesday"></td>
                            <td class="schedule-cell p-2" data-period="morning-5" data-day="wednesday"></td>
                            <td class="schedule-cell p-2" data-period="morning-5" data-day="thursday"></td>
                            <td class="schedule-cell p-2" data-period="morning-5" data-day="friday"></td>
                            <td class="schedule-cell p-2" data-period="morning-5" data-day="saturday"></td>
                        </tr>
                        
                        <!-- Ghi ch√∫ sau ti·∫øt 5 -->
                        <tr style="background: #ecfeff;">
                            <td style="background: #cffafe; color: #155e75;" class="p-2 text-center text-xs font-medium">üìù Ghi ch√∫</td>
                            <td class="note-cell p-1" data-note="note-after-morning-5" data-day="monday"></td>
                            <td class="note-cell p-1" data-note="note-after-morning-5" data-day="tuesday"></td>
                            <td class="note-cell p-1" data-note="note-after-morning-5" data-day="wednesday"></td>
                            <td class="note-cell p-1" data-note="note-after-morning-5" data-day="thursday"></td>
                            <td class="note-cell p-1" data-note="note-after-morning-5" data-day="friday"></td>
                            <td class="note-cell p-1" data-note="note-after-morning-5" data-day="saturday"></td>
                        </tr>

                        <!-- Bu·ªïi chi·ªÅu -->
                        <tr style="background: #fed7d7;">
                            <td colspan="7" class="p-2 text-center font-bold text-gray-800">
                                üåá BU·ªîI CHI·ªÄU
                            </td>
                        </tr>
                        
                        <!-- Ti·∫øt 1 chi·ªÅu -->
                        <tr class="border-b border-gray-100">
                            <td style="background: #d1fae5; color: #065f46;" class="p-3 font-semibold text-center">
                                Ti·∫øt 1<br><span class="text-xs opacity-80">13:00-13:45</span>
                            </td>
                            <td class="schedule-cell p-2" data-period="afternoon-1" data-day="monday"></td>
                            <td class="schedule-cell p-2" data-period="afternoon-1" data-day="tuesday"></td>
                            <td class="schedule-cell p-2" data-period="afternoon-1" data-day="wednesday"></td>
                            <td class="schedule-cell p-2" data-period="afternoon-1" data-day="thursday"></td>
                            <td class="schedule-cell p-2" data-period="afternoon-1" data-day="friday"></td>
                            <td class="schedule-cell p-2" data-period="afternoon-1" data-day="saturday"></td>
                        </tr>
                        
                        <!-- Ghi ch√∫ sau ti·∫øt 1 chi·ªÅu -->
                        <tr class="bg-cyan-50">
                            <td class="bg-cyan-100 p-2 text-center text-xs font-medium text-cyan-700">üìù Ghi ch√∫</td>
                            <td class="note-cell p-1" data-note="note-after-afternoon-1" data-day="monday"></td>
                            <td class="note-cell p-1" data-note="note-after-afternoon-1" data-day="tuesday"></td>
                            <td class="note-cell p-1" data-note="note-after-afternoon-1" data-day="wednesday"></td>
                            <td class="note-cell p-1" data-note="note-after-afternoon-1" data-day="thursday"></td>
                            <td class="note-cell p-1" data-note="note-after-afternoon-1" data-day="friday"></td>
                            <td class="note-cell p-1" data-note="note-after-afternoon-1" data-day="saturday"></td>
                        </tr>
                        
                        <!-- Ti·∫øt 2 chi·ªÅu -->
                        <tr class="border-b border-gray-100">
                            <td class="bg-indigo-200 text-indigo-800 p-3 font-semibold text-center">
                                Ti·∫øt 2<br><span class="text-xs opacity-80">13:45-14:30</span>
                            </td>
                            <td class="schedule-cell p-2" data-period="afternoon-2" data-day="monday"></td>
                            <td class="schedule-cell p-2" data-period="afternoon-2" data-day="tuesday"></td>
                            <td class="schedule-cell p-2" data-period="afternoon-2" data-day="wednesday"></td>
                            <td class="schedule-cell p-2" data-period="afternoon-2" data-day="thursday"></td>
                            <td class="schedule-cell p-2" data-period="afternoon-2" data-day="friday"></td>
                            <td class="schedule-cell p-2" data-period="afternoon-2" data-day="saturday"></td>
                        </tr>
                        
                        <!-- Ghi ch√∫ sau ti·∫øt 2 chi·ªÅu -->
                        <tr class="bg-indigo-50">
                            <td class="bg-indigo-100 p-2 text-center text-xs font-medium text-indigo-700">üìù Ghi ch√∫</td>
                            <td class="note-cell p-1" data-note="note-after-afternoon-2" data-day="monday"></td>
                            <td class="note-cell p-1" data-note="note-after-afternoon-2" data-day="tuesday"></td>
                            <td class="note-cell p-1" data-note="note-after-afternoon-2" data-day="wednesday"></td>
                            <td class="note-cell p-1" data-note="note-after-afternoon-2" data-day="thursday"></td>
                            <td class="note-cell p-1" data-note="note-after-afternoon-2" data-day="friday"></td>
                            <td class="note-cell p-1" data-note="note-after-afternoon-2" data-day="saturday"></td>
                        </tr>
                        
                        <!-- Ti·∫øt 3 chi·ªÅu -->
                        <tr class="border-b border-gray-100">
                            <td class="bg-teal-200 text-teal-800 p-3 font-semibold text-center">
                                Ti·∫øt 3<br><span class="text-xs opacity-80">14:30-15:15</span>
                            </td>
                            <td class="schedule-cell p-2" data-period="afternoon-3" data-day="monday"></td>
                            <td class="schedule-cell p-2" data-period="afternoon-3" data-day="tuesday"></td>
                            <td class="schedule-cell p-2" data-period="afternoon-3" data-day="wednesday"></td>
                            <td class="schedule-cell p-2" data-period="afternoon-3" data-day="thursday"></td>
                            <td class="schedule-cell p-2" data-period="afternoon-3" data-day="friday"></td>
                            <td class="schedule-cell p-2" data-period="afternoon-3" data-day="saturday"></td>
                        </tr>
                        
                        <!-- Ghi ch√∫ sau ti·∫øt 3 chi·ªÅu -->
                        <tr class="bg-teal-50">
                            <td class="bg-teal-100 p-2 text-center text-xs font-medium text-teal-700">üìù Ghi ch√∫</td>
                            <td class="note-cell p-1" data-note="note-after-afternoon-3" data-day="monday"></td>
                            <td class="note-cell p-1" data-note="note-after-afternoon-3" data-day="tuesday"></td>
                            <td class="note-cell p-1" data-note="note-after-afternoon-3" data-day="wednesday"></td>
                            <td class="note-cell p-1" data-note="note-after-afternoon-3" data-day="thursday"></td>
                            <td class="note-cell p-1" data-note="note-after-afternoon-3" data-day="friday"></td>
                            <td class="note-cell p-1" data-note="note-after-afternoon-3" data-day="saturday"></td>
                        </tr>
                        

                        
                        <!-- Ti·∫øt 4 chi·ªÅu -->
                        <tr class="border-b border-gray-100">
                            <td class="bg-rose-200 text-rose-800 p-3 font-semibold text-center">
                                Ti·∫øt 4<br><span class="text-xs opacity-80">15:45-16:30</span>
                            </td>
                            <td class="schedule-cell p-2" data-period="afternoon-4" data-day="monday"></td>
                            <td class="schedule-cell p-2" data-period="afternoon-4" data-day="tuesday"></td>
                            <td class="schedule-cell p-2" data-period="afternoon-4" data-day="wednesday"></td>
                            <td class="schedule-cell p-2" data-period="afternoon-4" data-day="thursday"></td>
                            <td class="schedule-cell p-2" data-period="afternoon-4" data-day="friday"></td>
                            <td class="schedule-cell p-2" data-period="afternoon-4" data-day="saturday"></td>
                        </tr>
                        
                        <!-- Ghi ch√∫ sau ti·∫øt 4 chi·ªÅu -->
                        <tr class="bg-rose-50">
                            <td class="bg-rose-100 p-2 text-center text-xs font-medium text-rose-700">üìù Ghi ch√∫</td>
                            <td class="note-cell p-1" data-note="note-after-afternoon-4" data-day="monday"></td>
                            <td class="note-cell p-1" data-note="note-after-afternoon-4" data-day="tuesday"></td>
                            <td class="note-cell p-1" data-note="note-after-afternoon-4" data-day="wednesday"></td>
                            <td class="note-cell p-1" data-note="note-after-afternoon-4" data-day="thursday"></td>
                            <td class="note-cell p-1" data-note="note-after-afternoon-4" data-day="friday"></td>
                            <td class="note-cell p-1" data-note="note-after-afternoon-4" data-day="saturday"></td>
                        </tr>
                        
                        <!-- Ti·∫øt 5 chi·ªÅu -->
                        <tr>
                            <td class="bg-emerald-200 text-emerald-800 p-3 font-semibold text-center">
                                Ti·∫øt 5<br><span class="text-xs opacity-80">16:30-17:15</span>
                            </td>
                            <td class="schedule-cell p-2" data-period="afternoon-5" data-day="monday"></td>
                            <td class="schedule-cell p-2" data-period="afternoon-5" data-day="tuesday"></td>
                            <td class="schedule-cell p-2" data-period="afternoon-5" data-day="wednesday"></td>
                            <td class="schedule-cell p-2" data-period="afternoon-5" data-day="thursday"></td>
                            <td class="schedule-cell p-2" data-period="afternoon-5" data-day="friday"></td>
                            <td class="schedule-cell p-2" data-period="afternoon-5" data-day="saturday"></td>
                        </tr>
                        
                        <!-- Ghi ch√∫ sau ti·∫øt 5 chi·ªÅu -->
                        <tr class="bg-emerald-50">
                            <td class="bg-emerald-100 p-2 text-center text-xs font-medium text-emerald-700">üìù Ghi ch√∫</td>
                            <td class="note-cell p-1" data-note="note-after-afternoon-5" data-day="monday"></td>
                            <td class="note-cell p-1" data-note="note-after-afternoon-5" data-day="tuesday"></td>
                            <td class="note-cell p-1" data-note="note-after-afternoon-5" data-day="wednesday"></td>
                            <td class="note-cell p-1" data-note="note-after-afternoon-5" data-day="thursday"></td>
                            <td class="note-cell p-1" data-note="note-after-afternoon-5" data-day="friday"></td>
                            <td class="note-cell p-1" data-note="note-after-afternoon-5" data-day="saturday"></td>
                        </tr>


                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Kh·ªüi t·∫°o c√°c √¥ nh·∫≠p li·ªáu
        function initializeSchedule() {
            const cells = document.querySelectorAll('.schedule-cell');
            cells.forEach(cell => {
                const period = cell.dataset.period;
                const day = cell.dataset.day;
                
                cell.innerHTML = `
                    <div class="space-y-1">
                        <input type="text" 
                               placeholder="M√¥n h·ªçc" 
                               class="w-full p-2 text-sm border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-300 focus:border-transparent bg-white"
                               data-field="subject"
                               id="subject-${period}-${day}">
                        <input type="text" 
                               placeholder="Gi√°o vi√™n" 
                               class="w-full p-1 text-xs border border-gray-200 rounded focus:ring-1 focus:ring-blue-300 focus:border-transparent bg-gray-50"
                               data-field="teacher"
                               id="teacher-${period}-${day}">
                        <input type="text" 
                               placeholder="Ph√≤ng h·ªçc" 
                               class="w-full p-1 text-xs border border-gray-200 rounded focus:ring-1 focus:ring-blue-300 focus:border-transparent bg-gray-50"
                               data-field="location"
                               id="location-${period}-${day}">
                    </div>
                `;
            });
            
            // Kh·ªüi t·∫°o c√°c √¥ ghi ch√∫
            const noteCells = document.querySelectorAll('.note-cell');
            noteCells.forEach(cell => {
                const note = cell.dataset.note;
                const day = cell.dataset.day;
                
                cell.innerHTML = `
                    <div class="space-y-1">
                        <textarea placeholder="Ghi ch√∫..." 
                                  class="w-full p-1 text-xs border border-gray-200 rounded focus:ring-1 focus:ring-blue-300 focus:border-transparent bg-white resize-none"
                                  rows="2"
                                  data-field="note"
                                  id="note-${note}-${day}"
                                  onchange="updateNoteDisplay(this)"></textarea>
                        <div class="note-items" id="items-${note}-${day}"></div>
                    </div>
                `;
            });
            
            // T·∫£i d·ªØ li·ªáu ƒë√£ l∆∞u
            loadSchedule();
        }

        // L∆∞u th·ªùi kh√≥a bi·ªÉu
        function saveSchedule() {
            const scheduleData = {};
            
            // L∆∞u d·ªØ li·ªáu c√°c ti·∫øt h·ªçc
            const cells = document.querySelectorAll('.schedule-cell');
            cells.forEach(cell => {
                const period = cell.dataset.period;
                const day = cell.dataset.day;
                const key = `${period}-${day}`;
                
                const subject = cell.querySelector('[data-field="subject"]').value;
                const teacher = cell.querySelector('[data-field="teacher"]').value;
                const location = cell.querySelector('[data-field="location"]').value;
                
                scheduleData[key] = {
                    subject: subject,
                    teacher: teacher,
                    location: location
                };
            });
            
            // L∆∞u d·ªØ li·ªáu ghi ch√∫
            const noteCells = document.querySelectorAll('.note-cell');
            noteCells.forEach(cell => {
                const note = cell.dataset.note;
                const day = cell.dataset.day;
                const key = `${note}-${day}`;
                
                const noteText = cell.querySelector('[data-field="note"]').value;
                
                scheduleData[key] = {
                    note: noteText
                };
            });
            
            // L∆∞u th·ªùi gian t√πy ch·ªânh cho bu·ªïi t·ªëi
            const timeCells = document.querySelectorAll('.time-cell');
            timeCells.forEach(cell => {
                const period = cell.dataset.period;
                const timeInput = cell.querySelector('[data-field="time"]');
                if (timeInput) {
                    scheduleData[`time-${period}`] = {
                        time: timeInput.value
                    };
                }
            });
            
            localStorage.setItem('scheduleData', JSON.stringify(scheduleData));
            showNotification('ƒê√£ l∆∞u! ‚ú®');
        }

        // T·∫£i th·ªùi kh√≥a bi·ªÉu ƒë√£ l∆∞u
        function loadSchedule() {
            const savedData = localStorage.getItem('scheduleData');
            if (savedData) {
                const scheduleData = JSON.parse(savedData);
                
                Object.keys(scheduleData).forEach(key => {
                    const data = scheduleData[key];
                    
                    if (key.includes('note-')) {
                        // T·∫£i ghi ch√∫
                        const noteInput = document.getElementById(key);
                        if (noteInput) {
                            noteInput.value = data.note || '';
                            updateNoteDisplay(noteInput);
                        }
                    } else if (key.startsWith('time-')) {
                        // T·∫£i th·ªùi gian t√πy ch·ªânh
                        const timeInput = document.getElementById(key);
                        if (timeInput) {
                            timeInput.value = data.time || '';
                        }
                    } else {
                        // T·∫£i d·ªØ li·ªáu ti·∫øt h·ªçc
                        const [period, day] = key.split('-');
                        
                        const subjectInput = document.getElementById(`subject-${period}-${day}`);
                        const teacherInput = document.getElementById(`teacher-${period}-${day}`);
                        const locationInput = document.getElementById(`location-${period}-${day}`);
                        
                        if (subjectInput) subjectInput.value = data.subject || '';
                        if (teacherInput) teacherInput.value = data.teacher || '';
                        if (locationInput) locationInput.value = data.location || '';
                    }
                });
            }
        }

        // X√≥a t·∫•t c·∫£ d·ªØ li·ªáu
        function clearSchedule() {
            const inputs = document.querySelectorAll('.schedule-cell input, .note-cell textarea');
            inputs.forEach(input => {
                input.value = '';
                if (input.dataset.field === 'note') {
                    updateNoteDisplay(input);
                }
            });
            
            // X√≥a t·∫•t c·∫£ d·ªØ li·ªáu trong localStorage
            const keys = Object.keys(localStorage);
            keys.forEach(key => {
                if (key.startsWith('scheduleData') || key.startsWith('checkbox-')) {
                    localStorage.removeItem(key);
                }
            });
            
            showNotification('ƒê√£ x√≥a! üóëÔ∏è');
        }

        // Hi·ªÉn th·ªã th√¥ng b√°o
        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.classList.remove('hidden');
            
            setTimeout(() => {
                notification.classList.add('hidden');
            }, 2000);
        }

        // C·∫≠p nh·∫≠t hi·ªÉn th·ªã ghi ch√∫ v·ªõi checkbox
        function updateNoteDisplay(textarea) {
            const noteId = textarea.id;
            const itemsContainer = document.getElementById(noteId.replace('note-', 'items-'));
            const noteText = textarea.value;
            
            // X√≥a n·ªôi dung c≈©
            itemsContainer.innerHTML = '';
            
            if (noteText.trim()) {
                // T√°ch c√°c d√≤ng ghi ch√∫
                const lines = noteText.split('\n').filter(line => line.trim());
                
                lines.forEach((line, index) => {
                    const itemId = `${noteId}-item-${index}`;
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'flex items-center space-x-1 text-xs';
                    itemDiv.innerHTML = `
                        <input type="checkbox" 
                               id="${itemId}" 
                               class="w-3 h-3 text-green-400 bg-white border-gray-300 rounded focus:ring-green-300 focus:ring-1"
                               onchange="toggleNoteItem(this)"
                               data-note-id="${noteId}">
                        <label for="${itemId}" 
                               class="flex-1 cursor-pointer transition-all duration-200" 
                               id="label-${itemId}">${line.trim()}</label>
                    `;
                    itemsContainer.appendChild(itemDiv);
                });
            }
            
            // T·∫£i tr·∫°ng th√°i checkbox ƒë√£ l∆∞u
            loadCheckboxStates(noteId);
        }

        // X·ª≠ l√Ω khi tick/untick checkbox
        function toggleNoteItem(checkbox) {
            const label = document.getElementById(`label-${checkbox.id}`);
            const noteId = checkbox.dataset.noteId;
            
            if (checkbox.checked) {
                label.classList.add('line-through', 'text-gray-400', 'opacity-60');
                label.innerHTML = '‚úÖ ' + label.textContent.replace('‚úÖ ', '');
            } else {
                label.classList.remove('line-through', 'text-gray-400', 'opacity-60');
                label.innerHTML = label.textContent.replace('‚úÖ ', '');
            }
            
            // L∆∞u tr·∫°ng th√°i checkbox
            saveCheckboxStates(noteId);
        }

        // L∆∞u tr·∫°ng th√°i checkbox
        function saveCheckboxStates(noteId) {
            const checkboxes = document.querySelectorAll(`input[data-note-id="${noteId}"]`);
            const states = {};
            
            checkboxes.forEach((checkbox, index) => {
                states[index] = checkbox.checked;
            });
            
            localStorage.setItem(`checkbox-${noteId}`, JSON.stringify(states));
        }

        // T·∫£i tr·∫°ng th√°i checkbox ƒë√£ l∆∞u
        function loadCheckboxStates(noteId) {
            const savedStates = localStorage.getItem(`checkbox-${noteId}`);
            if (savedStates) {
                const states = JSON.parse(savedStates);
                const checkboxes = document.querySelectorAll(`input[data-note-id="${noteId}"]`);
                
                checkboxes.forEach((checkbox, index) => {
                    if (states[index]) {
                        checkbox.checked = true;
                        toggleNoteItem(checkbox);
                    }
                });
            }
        }

        // T·ª± ƒë·ªông l∆∞u khi ng∆∞·ªùi d√πng nh·∫≠p
        function setupAutoSave() {
            document.addEventListener('input', function(e) {
                if (e.target.matches('.schedule-cell input') || e.target.matches('.note-cell textarea') || e.target.matches('.time-cell input')) {
                    // Debounce auto-save
                    clearTimeout(window.autoSaveTimeout);
                    window.autoSaveTimeout = setTimeout(() => {
                        saveSchedule();
                    }, 1000);
                }
            });
            
            // X·ª≠ l√Ω ph√≠m Enter ƒë·ªÉ chuy·ªÉn sang √¥ ti·∫øp theo
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    const target = e.target;
                    
                    // Ch·ªâ √°p d·ª•ng cho input trong schedule-cell v√† time-cell, kh√¥ng √°p d·ª•ng cho textarea
                    if (target.matches('.schedule-cell input') || target.matches('.time-cell input')) {
                        e.preventDefault();
                        
                        // T√¨m √¥ input ti·∫øp theo
                        const allInputs = Array.from(document.querySelectorAll('.schedule-cell input, .time-cell input'));
                        const currentIndex = allInputs.indexOf(target);
                        
                        if (currentIndex >= 0 && currentIndex < allInputs.length - 1) {
                            allInputs[currentIndex + 1].focus();
                        }
                    }
                }
            });
        }

        // T·∫£i file Excel m·∫´u
        function downloadTemplate() {
            // T·∫°o d·ªØ li·ªáu m·∫´u cho Excel
            const templateData = [
                ['Th·ªùi kh√≥a bi·ªÉu - File m·∫´u', '', '', '', '', '', ''],
                ['', '', '', '', '', '', ''],
                ['Th·ªùi gian', 'Th·ª© 2', 'Th·ª© 3', 'Th·ª© 4', 'Th·ª© 5', 'Th·ª© 6', 'Th·ª© 7'],
                ['', '', '', '', '', '', ''],
                ['BU·ªîI S√ÅNG', '', '', '', '', '', ''],
                ['Ti·∫øt 1 (7:00-7:45)', '', '', '', '', '', ''],
                ['- M√¥n h·ªçc', 'To√°n', 'VƒÉn', 'Anh', 'L√Ω', 'H√≥a', 'Sinh'],
                ['- Gi√°o vi√™n', 'C√¥ Lan', 'Th·∫ßy Nam', 'C√¥ Hoa', 'Th·∫ßy Minh', 'C√¥ Mai', 'Th·∫ßy ƒê·ª©c'],
                ['- Ph√≤ng h·ªçc', 'A101', 'A102', 'A103', 'A104', 'A105', 'A106'],
                ['- Ghi ch√∫', 'Mang m√°y t√≠nh', 'N·ªôp b√†i t·∫≠p', '', 'Th√≠ nghi·ªám', '', ''],
                ['', '', '', '', '', '', ''],
                ['Ti·∫øt 2 (7:45-8:30)', '', '', '', '', '', ''],
                ['- M√¥n h·ªçc', '', '', '', '', '', ''],
                ['- Gi√°o vi√™n', '', '', '', '', '', ''],
                ['- Ph√≤ng h·ªçc', '', '', '', '', '', ''],
                ['- Ghi ch√∫', '', '', '', '', '', ''],
                ['', '', '', '', '', '', ''],
                ['Ra ch∆°i (8:30-9:00)', '', '', '', '', '', ''],
                ['', '', '', '', '', '', ''],
                ['Ti·∫øt 3 (9:00-9:45)', '', '', '', '', '', ''],
                ['- M√¥n h·ªçc', '', '', '', '', '', ''],
                ['- Gi√°o vi√™n', '', '', '', '', '', ''],
                ['- Ph√≤ng h·ªçc', '', '', '', '', '', ''],
                ['- Ghi ch√∫', '', '', '', '', '', ''],
                ['', '', '', '', '', '', ''],
                ['Ti·∫øt 4 (9:45-10:30)', '', '', '', '', '', ''],
                ['- M√¥n h·ªçc', '', '', '', '', '', ''],
                ['- Gi√°o vi√™n', '', '', '', '', '', ''],
                ['- Ph√≤ng h·ªçc', '', '', '', '', '', ''],
                ['- Ghi ch√∫', '', '', '', '', '', ''],
                ['', '', '', '', '', '', ''],
                ['Ti·∫øt 5 (10:30-11:15)', '', '', '', '', '', ''],
                ['- M√¥n h·ªçc', '', '', '', '', '', ''],
                ['- Gi√°o vi√™n', '', '', '', '', '', ''],
                ['- Ph√≤ng h·ªçc', '', '', '', '', '', ''],
                ['- Ghi ch√∫', '', '', '', '', '', ''],
                ['', '', '', '', '', '', ''],
                ['BU·ªîI CHI·ªÄU', '', '', '', '', '', ''],
                ['Ti·∫øt 1 (13:00-13:45)', '', '', '', '', '', ''],
                ['- M√¥n h·ªçc', '', '', '', '', '', ''],
                ['- Gi√°o vi√™n', '', '', '', '', '', ''],
                ['- Ph√≤ng h·ªçc', '', '', '', '', '', ''],
                ['- Ghi ch√∫', '', '', '', '', '', ''],
                ['', '', '', '', '', '', ''],
                ['Ti·∫øt 2 (13:45-14:30)', '', '', '', '', '', ''],
                ['- M√¥n h·ªçc', '', '', '', '', '', ''],
                ['- Gi√°o vi√™n', '', '', '', '', '', ''],
                ['- Ph√≤ng h·ªçc', '', '', '', '', '', ''],
                ['- Ghi ch√∫', '', '', '', '', '', ''],
                ['', '', '', '', '', '', ''],
                ['Ti·∫øt 3 (14:30-15:15)', '', '', '', '', '', ''],
                ['- M√¥n h·ªçc', '', '', '', '', '', ''],
                ['- Gi√°o vi√™n', '', '', '', '', '', ''],
                ['- Ph√≤ng h·ªçc', '', '', '', '', '', ''],
                ['- Ghi ch√∫', '', '', '', '', '', ''],
                ['', '', '', '', '', '', ''],
                ['Ra ch∆°i (15:15-15:45)', '', '', '', '', '', ''],
                ['', '', '', '', '', '', ''],
                ['Ti·∫øt 4 (15:45-16:30)', '', '', '', '', '', ''],
                ['- M√¥n h·ªçc', '', '', '', '', '', ''],
                ['- Gi√°o vi√™n', '', '', '', '', '', ''],
                ['- Ph√≤ng h·ªçc', '', '', '', '', '', ''],
                ['- Ghi ch√∫', '', '', '', '', '', ''],
                ['', '', '', '', '', '', ''],
                ['Ti·∫øt 5 (16:30-17:15)', '', '', '', '', '', ''],
                ['- M√¥n h·ªçc', '', '', '', '', '', ''],
                ['- Gi√°o vi√™n', '', '', '', '', '', ''],
                ['- Ph√≤ng h·ªçc', '', '', '', '', '', ''],
                ['- Ghi ch√∫', '', '', '', '', '', ''],
                ['', '', '', '', '', '', ''],

                ['', '', '', '', '', '', ''],
                ['H∆Ø·ªöNG D·∫™N S·ª¨ D·ª§NG:', '', '', '', '', '', ''],
                ['1. ƒêi·ªÅn th√¥ng tin v√†o c√°c √¥ t∆∞∆°ng ·ª©ng', '', '', '', '', '', ''],
                ['2. L∆∞u file Excel', '', '', '', '', '', ''],
                ['3. T·∫£i file l√™n b·∫±ng n√∫t "T·∫£i Excel l√™n"', '', '', '', '', '', ''],
                ['4. D·ªØ li·ªáu s·∫Ω t·ª± ƒë·ªông ƒëi·ªÅn v√†o th·ªùi kh√≥a bi·ªÉu', '', '', '', '', '', '']
            ];

            // T·∫°o workbook v√† worksheet
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.aoa_to_sheet(templateData);

            // ƒê·ªãnh d·∫°ng c·ªôt
            ws['!cols'] = [
                { wch: 25 }, // C·ªôt th·ªùi gian
                { wch: 15 }, // Th·ª© 2
                { wch: 15 }, // Th·ª© 3
                { wch: 15 }, // Th·ª© 4
                { wch: 15 }, // Th·ª© 5
                { wch: 15 }, // Th·ª© 6
                { wch: 15 }  // Th·ª© 7
            ];

            // Th√™m worksheet v√†o workbook
            XLSX.utils.book_append_sheet(wb, ws, 'Th·ªùi kh√≥a bi·ªÉu');

            // T·∫£i xu·ªëng file
            XLSX.writeFile(wb, `mau-thoi-khoa-bieu-${new Date().toLocaleDateString('vi-VN').replace(/\//g, '-')}.xlsx`);
            showNotification('ƒê√£ t·∫£i file m·∫´u Excel! üìã');
        }

        // Nh·∫≠p d·ªØ li·ªáu t·ª´ file Excel
        function importFromExcel(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });

                    // X·ª≠ l√Ω d·ªØ li·ªáu v√† ƒëi·ªÅn v√†o form
                    processExcelData(jsonData);
                    showNotification('ƒê√£ nh·∫≠p d·ªØ li·ªáu t·ª´ Excel! üìÇ');
                } catch (error) {
                    console.error('L·ªói khi ƒë·ªçc file Excel:', error);
                    showNotification('L·ªói ƒë·ªçc file Excel! ‚ùå');
                }
            };
            reader.readAsArrayBuffer(file);
            
            // Reset input ƒë·ªÉ c√≥ th·ªÉ t·∫£i c√πng file nhi·ªÅu l·∫ßn
            event.target.value = '';
        }

        // X·ª≠ l√Ω d·ªØ li·ªáu Excel v√† ƒëi·ªÅn v√†o form
        function processExcelData(data) {
            const periods = [
                'morning-1', 'morning-2', 'morning-3', 'morning-4', 'morning-5',
                'afternoon-1', 'afternoon-2', 'afternoon-3', 'afternoon-4', 'afternoon-5'
            ];
            
            const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];
            
            // T√¨m v√† ƒëi·ªÅn d·ªØ li·ªáu cho t·ª´ng ti·∫øt h·ªçc
            for (let i = 0; i < data.length; i++) {
                const row = data[i];
                if (!row || !row[0]) continue;
                
                const timeCell = row[0].toString().toLowerCase();
                
                // X√°c ƒë·ªãnh ti·∫øt h·ªçc d·ª±a tr√™n n·ªôi dung √¥ ƒë·∫ßu ti√™n
                let currentPeriod = null;
                
                if (timeCell.includes('ti·∫øt 1') && timeCell.includes('7:00')) {
                    currentPeriod = 'morning-1';
                } else if (timeCell.includes('ti·∫øt 2') && timeCell.includes('7:45')) {
                    currentPeriod = 'morning-2';
                } else if (timeCell.includes('ti·∫øt 3') && timeCell.includes('9:00')) {
                    currentPeriod = 'morning-3';
                } else if (timeCell.includes('ti·∫øt 4') && timeCell.includes('9:45')) {
                    currentPeriod = 'morning-4';
                } else if (timeCell.includes('ti·∫øt 5') && timeCell.includes('10:30')) {
                    currentPeriod = 'morning-5';
                } else if (timeCell.includes('ti·∫øt 1') && timeCell.includes('13:00')) {
                    currentPeriod = 'afternoon-1';
                } else if (timeCell.includes('ti·∫øt 2') && timeCell.includes('13:45')) {
                    currentPeriod = 'afternoon-2';
                } else if (timeCell.includes('ti·∫øt 3') && timeCell.includes('14:30')) {
                    currentPeriod = 'afternoon-3';
                } else if (timeCell.includes('ti·∫øt 4') && timeCell.includes('15:45')) {
                    currentPeriod = 'afternoon-4';
                } else if (timeCell.includes('ti·∫øt 5') && timeCell.includes('16:30')) {
                    currentPeriod = 'afternoon-5';

                }
                
                if (currentPeriod) {
                    // ƒêi·ªÅn d·ªØ li·ªáu cho ti·∫øt h·ªçc n√†y
                    fillPeriodData(data, i, currentPeriod, days);
                }
            }
            
            // L∆∞u d·ªØ li·ªáu sau khi nh·∫≠p
            saveSchedule();
        }

        // ƒêi·ªÅn d·ªØ li·ªáu cho m·ªôt ti·∫øt h·ªçc c·ª• th·ªÉ
        function fillPeriodData(data, startRow, period, days) {
            const fieldMap = {
                'm√¥n h·ªçc': 'subject',
                'gi√°o vi√™n': 'teacher',
                'ph√≤ng h·ªçc': 'location',
                'ƒë·ªãa ch·ªâ n∆°i h·ªçc': 'location',
                'ghi ch√∫': 'note'
            };
            
            // Duy·ªát qua 5 d√≤ng ti·∫øp theo ƒë·ªÉ t√¨m d·ªØ li·ªáu
            for (let i = startRow + 1; i < Math.min(startRow + 6, data.length); i++) {
                const row = data[i];
                if (!row || !row[0]) continue;
                
                const fieldName = row[0].toString().toLowerCase().replace('- ', '');
                const fieldType = fieldMap[fieldName];
                
                if (fieldType) {
                    // ƒêi·ªÅn d·ªØ li·ªáu cho t·ª´ng ng√†y trong tu·∫ßn
                    days.forEach((day, dayIndex) => {
                        const cellValue = row[dayIndex + 1] || '';
                        
                        if (fieldType === 'note') {
                            // X·ª≠ l√Ω ghi ch√∫
                            const noteId = `note-note-after-${period}-${day}`;
                            const noteInput = document.getElementById(noteId);
                            if (noteInput && cellValue) {
                                noteInput.value = cellValue.toString();
                                updateNoteDisplay(noteInput);
                            }
                        } else {
                            // X·ª≠ l√Ω m√¥n h·ªçc, gi√°o vi√™n, ph√≤ng h·ªçc
                            const inputId = `${fieldType}-${period}-${day}`;
                            const input = document.getElementById(inputId);
                            if (input && cellValue) {
                                input.value = cellValue.toString();
                            }
                        }
                    });
                }
            }
        }

        // Xu·∫•t d·ªØ li·ªáu ra file Excel
        function exportToExcel() {
            const periods = [
                { id: 'morning-1', name: 'Ti·∫øt 1 (7:00-7:45)', session: 'BU·ªîI S√ÅNG' },
                { id: 'morning-2', name: 'Ti·∫øt 2 (7:45-8:30)', session: '' },
                { id: 'morning-3', name: 'Ti·∫øt 3 (9:00-9:45)', session: '' },
                { id: 'morning-4', name: 'Ti·∫øt 4 (9:45-10:30)', session: '' },
                { id: 'morning-5', name: 'Ti·∫øt 5 (10:30-11:15)', session: '' },
                { id: 'afternoon-1', name: 'Ti·∫øt 1 (13:00-13:45)', session: 'BU·ªîI CHI·ªÄU' },
                { id: 'afternoon-2', name: 'Ti·∫øt 2 (13:45-14:30)', session: '' },
                { id: 'afternoon-3', name: 'Ti·∫øt 3 (14:30-15:15)', session: '' },
                { id: 'afternoon-4', name: 'Ti·∫øt 4 (15:45-16:30)', session: '' },
                { id: 'afternoon-5', name: 'Ti·∫øt 5 (16:30-17:15)', session: '' }
            ];
            
            const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];
            const dayNames = ['Th·ª© 2', 'Th·ª© 3', 'Th·ª© 4', 'Th·ª© 5', 'Th·ª© 6', 'Th·ª© 7'];
            
            const exportData = [];
            
            // Ti√™u ƒë·ªÅ
            exportData.push(['Th·ªùi kh√≥a bi·ªÉu', '', '', '', '', '', '']);
            exportData.push(['', '', '', '', '', '', '']);
            exportData.push(['Th·ªùi gian', ...dayNames]);
            exportData.push(['', '', '', '', '', '', '']);
            
            periods.forEach(period => {
                // Th√™m ti√™u ƒë·ªÅ bu·ªïi h·ªçc n·∫øu c√≥
                if (period.session) {
                    exportData.push([period.session, '', '', '', '', '', '']);
                }
                
                // Th√™m t√™n ti·∫øt h·ªçc
                exportData.push([period.name, '', '', '', '', '', '']);
                
                // Th√™m d·ªØ li·ªáu m√¥n h·ªçc
                const subjectRow = ['- M√¥n h·ªçc'];
                const teacherRow = ['- Gi√°o vi√™n'];
                const locationRow = ['- Ph√≤ng h·ªçc'];
                const noteRow = ['- Ghi ch√∫'];
                
                days.forEach(day => {
                    const subjectInput = document.getElementById(`subject-${period.id}-${day}`);
                    const teacherInput = document.getElementById(`teacher-${period.id}-${day}`);
                    const locationInput = document.getElementById(`location-${period.id}-${day}`);
                    const noteInput = document.getElementById(`note-note-after-${period.id}-${day}`);
                    
                    subjectRow.push(subjectInput ? subjectInput.value : '');
                    teacherRow.push(teacherInput ? teacherInput.value : '');
                    locationRow.push(locationInput ? locationInput.value : '');
                    noteRow.push(noteInput ? noteInput.value : '');
                });
                
                exportData.push(subjectRow);
                exportData.push(teacherRow);
                exportData.push(locationRow);
                exportData.push(noteRow);
                exportData.push(['', '', '', '', '', '', '']);
            });
            
            // T·∫°o workbook v√† worksheet
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.aoa_to_sheet(exportData);
            
            // ƒê·ªãnh d·∫°ng c·ªôt
            ws['!cols'] = [
                { wch: 25 }, // C·ªôt th·ªùi gian
                { wch: 15 }, // Th·ª© 2
                { wch: 15 }, // Th·ª© 3
                { wch: 15 }, // Th·ª© 4
                { wch: 15 }, // Th·ª© 5
                { wch: 15 }, // Th·ª© 6
                { wch: 15 }  // Th·ª© 7
            ];
            
            // Th√™m worksheet v√†o workbook
            XLSX.utils.book_append_sheet(wb, ws, 'Th·ªùi kh√≥a bi·ªÉu');
            
            // T·∫£i xu·ªëng file
            XLSX.writeFile(wb, `thoi-khoa-bieu-${new Date().toLocaleDateString('vi-VN').replace(/\//g, '-')}.xlsx`);
            showNotification('ƒê√£ xu·∫•t Excel! üìä');
        }

        // Xu·∫•t th·ªùi kh√≥a bi·ªÉu th√†nh h√¨nh ·∫£nh
        function exportAsImage() {
            // ·∫®n c√°c n√∫t ƒëi·ªÅu khi·ªÉn t·∫°m th·ªùi
            const controlButtons = document.querySelector('.flex.justify-center.gap-3.mb-6.flex-wrap');
            const notification = document.getElementById('notification');
            
            controlButtons.style.display = 'none';
            notification.classList.add('hidden');
            
            // T·∫°o container t·∫°m th·ªùi ƒë·ªÉ xu·∫•t h√¨nh v·ªõi k√≠ch th∆∞·ªõc t·ªëi ∆∞u cho mobile
            const tempContainer = document.createElement('div');
            tempContainer.style.cssText = `
                position: fixed;
                top: -10000px;
                left: 0;
                width: 375px;
                background: linear-gradient(135deg, #fef3c7 0%, #fce7f3 50%, #dbeafe 100%);
                padding: 16px;
                font-family: system-ui, -apple-system, sans-serif;
                z-index: -1;
            `;
            
            // Clone n·ªôi dung ch√≠nh
            const originalTable = document.querySelector('.bg-white.rounded-3xl.shadow-lg');
            const clonedContent = originalTable.cloneNode(true);
            
            // T·ªëi ∆∞u h√≥a cho mobile
            clonedContent.style.cssText = `
                background: white;
                border-radius: 16px;
                box-shadow: 0 10px 25px rgba(0,0,0,0.1);
                overflow: hidden;
                border: 2px solid #e5e7eb;
                font-size: 11px;
            `;
            
            // T·ªëi ∆∞u b·∫£ng cho mobile
            const table = clonedContent.querySelector('table');
            if (table) {
                table.style.cssText = `
                    width: 100%;
                    border-collapse: collapse;
                    font-size: 10px;
                `;
                
                // T·ªëi ∆∞u header
                const headerCells = table.querySelectorAll('thead th');
                headerCells.forEach((cell, index) => {
                    if (index === 0) {
                        cell.style.cssText = `
                            padding: 8px 4px;
                            font-size: 9px;
                            font-weight: bold;
                            text-align: left;
                            width: 80px;
                            background: linear-gradient(135deg, #a855f7, #ec4899);
                            color: white;
                        `;
                    } else {
                        cell.style.cssText = `
                            padding: 8px 2px;
                            font-size: 9px;
                            font-weight: bold;
                            text-align: center;
                            width: 42px;
                            background: linear-gradient(135deg, #a855f7, #ec4899);
                            color: white;
                        `;
                    }
                });
                
                // T·ªëi ∆∞u c√°c √¥ th·ªùi gian
                const timeCells = table.querySelectorAll('tbody td:first-child');
                timeCells.forEach(cell => {
                    if (cell.textContent.includes('BU·ªîI')) {
                        cell.style.cssText = `
                            padding: 6px 4px;
                            text-align: center;
                            font-weight: bold;
                            font-size: 9px;
                            color: #374151;
                        `;
                    } else if (cell.textContent.includes('Ti·∫øt') || cell.textContent.includes('Ra ch∆°i')) {
                        cell.style.cssText = `
                            padding: 6px 4px;
                            font-weight: bold;
                            text-align: center;
                            font-size: 8px;
                            color: white;
                            width: 80px;
                        `;
                    } else if (cell.textContent.includes('Ghi ch√∫')) {
                        cell.style.cssText = `
                            padding: 4px;
                            text-align: center;
                            font-size: 7px;
                            font-weight: 500;
                            width: 80px;
                        `;
                    }
                });
                
                // T·ªëi ∆∞u c√°c √¥ n·ªôi dung
                const contentCells = table.querySelectorAll('tbody td:not(:first-child)');
                contentCells.forEach(cell => {
                    const inputs = cell.querySelectorAll('input, textarea');
                    let cellContent = '';
                    
                    inputs.forEach(input => {
                        if (input.value.trim()) {
                            if (input.dataset.field === 'subject') {
                                cellContent += `<div style="font-weight: bold; color: #1f2937; margin-bottom: 2px; font-size: 9px;">${input.value}</div>`;
                            } else if (input.dataset.field === 'teacher') {
                                cellContent += `<div style="color: #6b7280; font-size: 8px; margin-bottom: 1px;">${input.value}</div>`;
                            } else if (input.dataset.field === 'location') {
                                cellContent += `<div style="color: #9ca3af; font-size: 7px; margin-bottom: 1px;">${input.value}</div>`;
                            } else if (input.dataset.field === 'note') {
                                const notes = input.value.split('\n').filter(n => n.trim());
                                notes.forEach(note => {
                                    cellContent += `<div style="color: #059669; font-size: 7px; margin-bottom: 1px;">‚Ä¢ ${note.trim()}</div>`;
                                });
                            }
                        }
                    });
                    
                    cell.innerHTML = cellContent || '';
                    cell.style.cssText = `
                        padding: 4px 2px;
                        vertical-align: top;
                        border-bottom: 1px solid #f3f4f6;
                        width: 42px;
                        min-height: 35px;
                        font-size: 8px;
                        line-height: 1.2;
                    `;
                });
            }
            
            // Th√™m ti√™u ƒë·ªÅ
            const header = document.createElement('div');
            header.style.cssText = `
                text-align: center;
                margin-bottom: 12px;
                padding: 8px;
            `;
            header.innerHTML = `
                <h1 style="font-size: 18px; font-weight: bold; color: #374151; margin: 0 0 4px 0;">üìÖ Th·ªùi Kh√≥a Bi·ªÉu</h1>
                <p style="font-size: 12px; color: #6b7280; margin: 0;">ƒê∆°n gi·∫£n & Hi·ªáu qu·∫£</p>
            `;
            
            tempContainer.appendChild(header);
            tempContainer.appendChild(clonedContent);
            
            // Th√™m footer v·ªõi th·ªùi gian xu·∫•t
            const footer = document.createElement('div');
            footer.style.cssText = `
                text-align: center;
                margin-top: 12px;
                padding: 8px;
                font-size: 10px;
                color: #9ca3af;
            `;
            footer.innerHTML = `Xu·∫•t ng√†y: ${new Date().toLocaleDateString('vi-VN')} ${new Date().toLocaleTimeString('vi-VN')}`;
            tempContainer.appendChild(footer);
            
            document.body.appendChild(tempContainer);
            
            // ƒê·ª£i m·ªôt ch√∫t ƒë·ªÉ render
            setTimeout(() => {
                // C·∫•u h√¨nh html2canvas t·ªëi ∆∞u cho mobile
                const options = {
                    backgroundColor: '#ffffff',
                    scale: 3, // TƒÉng ƒë·ªô ph√¢n gi·∫£i cao cho mobile
                    useCORS: true,
                    allowTaint: true,
                    width: 375,
                    height: tempContainer.scrollHeight,
                    scrollX: 0,
                    scrollY: 0,
                    logging: false,
                    removeContainer: true
                };
                
                // Ch·ª•p ·∫£nh v√† t·∫£i xu·ªëng
                html2canvas(tempContainer, options).then(canvas => {
                    // T·∫°o link t·∫£i xu·ªëng
                    const link = document.createElement('a');
                    link.download = `thoi-khoa-bieu-mobile-${new Date().toLocaleDateString('vi-VN').replace(/\//g, '-')}.png`;
                    link.href = canvas.toDataURL('image/png', 0.95);
                    
                    // T·ª± ƒë·ªông click ƒë·ªÉ t·∫£i xu·ªëng
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    // D·ªçn d·∫πp
                    document.body.removeChild(tempContainer);
                    controlButtons.style.display = 'flex';
                    showNotification('ƒê√£ xu·∫•t h√¨nh mobile! üì±');
                    
                }).catch(error => {
                    console.error('L·ªói khi xu·∫•t h√¨nh ·∫£nh:', error);
                    document.body.removeChild(tempContainer);
                    controlButtons.style.display = 'flex';
                    showNotification('L·ªói xu·∫•t h√¨nh ·∫£nh! ‚ùå');
                });
            }, 100);
        }

        // Bi·∫øn l∆∞u tr·ªØ m√†u ƒë√£ ch·ªçn v√† ch·∫ø ƒë·ªô ch·ªçn m√†u
        let selectedColor = null;
        let colorMode = false;

        // ƒê·ªãnh nghƒ©a 6 m√†u pastel theo y√™u c·∫ßu
        const headerColorSchemes = {
            buttercup: {
                header: 'background: #fef3c7;',
                timeCell: 'background: #fefce8;',
                textColor: '#92400e' // V√†ng ƒë·∫≠m
            },
            softpeach: {
                header: 'background: #fed7d7;',
                timeCell: 'background: #fef2f2;',
                textColor: '#c2410c' // Cam ƒë·∫≠m
            },
            palepink: {
                header: 'background: #fce7f3;',
                timeCell: 'background: #fdf2f8;',
                textColor: '#be185d' // H·ªìng ƒë·∫≠m
            },
            lavender: {
                header: 'background: #e9d5ff;',
                timeCell: 'background: #f3e8ff;',
                textColor: '#6b21a8' // T√≠m ƒë·∫≠m
            },
            coolaqua: {
                header: 'background: #cffafe;',
                timeCell: 'background: #ecfeff;',
                textColor: '#155e75' // Xanh cyan ƒë·∫≠m
            },
            meadowgreen: {
                header: 'background: #d1fae5;',
                timeCell: 'background: #ecfdf5;',
                textColor: '#065f46' // Xanh l√° ƒë·∫≠m
            }
        };

        // ƒê·ªãnh nghƒ©a m√†u s·∫Øc cho ph·∫ßn ghi ch√∫
        const noteColorSchemes = {
            buttercup: {
                background: '#fefce8', // V√†ng nh·∫°t h∆°n
                textColor: '#92400e',
                borderColor: '#fbbf24'
            },
            softpeach: {
                background: '#fef2f2', // Cam nh·∫°t h∆°n
                textColor: '#c2410c',
                borderColor: '#fb923c'
            },
            palepink: {
                background: '#fdf2f8', // H·ªìng nh·∫°t h∆°n
                textColor: '#be185d',
                borderColor: '#f472b6'
            },
            lavender: {
                background: '#f3e8ff', // T√≠m nh·∫°t h∆°n
                textColor: '#6b21a8',
                borderColor: '#a855f7'
            },
            coolaqua: {
                background: '#ecfeff', // Xanh cyan nh·∫°t h∆°n
                textColor: '#155e75',
                borderColor: '#22d3ee'
            },
            meadowgreen: {
                background: '#ecfdf5', // Xanh l√° nh·∫°t h∆°n
                textColor: '#065f46',
                borderColor: '#34d399'
            }
        };

        // Hi·ªÉn th·ªã/·∫©n b·∫£ng ch·ªçn m√†u
        function toggleColorPalette() {
            const palette = document.getElementById('colorPalette');
            if (palette.classList.contains('hidden')) {
                palette.classList.remove('hidden');
                palette.style.animation = 'fadeIn 0.3s ease-out';
            } else {
                palette.classList.add('hidden');
            }
        }

        // Ch·ªçn m√†u
        function selectColor(color) {
            selectedColor = color;
            
            // C·∫≠p nh·∫≠t hi·ªÉn th·ªã m√†u ƒë√£ ch·ªçn
            const colorInfo = document.getElementById('selectedColorInfo');
            const colorNames = {
                'buttercup': 'Buttercup',
                'softpeach': 'Soft Peach', 
                'palepink': 'Pale Pink',
                'lavender': 'Lavender',
                'coolaqua': 'Cool Aqua',
                'meadowgreen': 'Meadow Green'
            };
            colorInfo.textContent = `ƒê√£ ch·ªçn m√†u: ${colorNames[color]}`;
            
            // Highlight m√†u ƒë√£ ch·ªçn
            document.querySelectorAll('.color-option').forEach(option => {
                const colorDiv = option.querySelector('div');
                if (option.dataset.color === color) {
                    colorDiv.style.transform = 'scale(1.1)';
                    colorDiv.style.boxShadow = '0 4px 12px rgba(0,0,0,0.2)';
                } else {
                    colorDiv.style.transform = 'scale(1)';
                    colorDiv.style.boxShadow = 'none';
                }
            });
            
            showNotification(`ƒê√£ ch·ªçn m√†u: ${colorNames[color]} üé®`);
        }



        // √Åp d·ª•ng m√†u cho header v√† c·ªôt th·ªùi gian
        function applyColorToHeaders() {
            if (!selectedColor) {
                showNotification('Vui l√≤ng ch·ªçn m√†u tr∆∞·ªõc! üé®');
                return;
            }
            
            const colorScheme = headerColorSchemes[selectedColor];
            const colorNames = {
                'buttercup': 'Buttercup',
                'softpeach': 'Soft Peach', 
                'palepink': 'Pale Pink',
                'lavender': 'Lavender',
                'coolaqua': 'Cool Aqua',
                'meadowgreen': 'Meadow Green'
            };
            
            if (colorScheme) {
                // √Åp d·ª•ng m√†u cho d√≤ng header ch√≠nh
                const headerRow = document.querySelector('thead tr');
                if (headerRow) {
                    headerRow.style.cssText = colorScheme.header + ` color: ${colorScheme.textColor}; font-weight: bold;`;
                }
                
                // √Åp d·ª•ng m√†u cho t·∫•t c·∫£ c√°c √¥ th·ªùi gian (c·ªôt ƒë·∫ßu ti√™n)
                const timeCells = document.querySelectorAll('tbody td:first-child');
                timeCells.forEach(cell => {
                    if (cell.textContent.includes('Ti·∫øt') || cell.textContent.includes('Ra ch∆°i') || cell.classList.contains('time-cell')) {
                        cell.style.cssText = colorScheme.timeCell + ` color: ${colorScheme.textColor}; padding: 12px; font-weight: bold; text-align: center;`;
                    }
                });
                
                // ƒê·∫∑t t·∫•t c·∫£ √¥ n·ªôi dung v·ªÅ m√†u tr·∫Øng
                const contentCells = document.querySelectorAll('.schedule-cell, .note-cell');
                contentCells.forEach(cell => {
                    cell.style.background = 'white';
                    cell.dataset.cellColor = 'white';
                });
                
                // L∆∞u m√†u header ƒë√£ ch·ªçn
                localStorage.setItem('headerColor', selectedColor);
                
                showNotification(`ƒê√£ √°p d·ª•ng m√†u ${colorNames[selectedColor]} cho ti√™u ƒë·ªÅ! üé®`);
            }
        }

        // √Åp d·ª•ng m√†u cho t·∫•t c·∫£ ph·∫ßn ghi ch√∫
        function applyColorToNotes() {
            if (!selectedColor) {
                showNotification('Vui l√≤ng ch·ªçn m√†u tr∆∞·ªõc! üé®');
                return;
            }
            
            const colorScheme = noteColorSchemes[selectedColor];
            const colorNames = {
                'buttercup': 'Buttercup',
                'softpeach': 'Soft Peach', 
                'palepink': 'Pale Pink',
                'lavender': 'Lavender',
                'coolaqua': 'Cool Aqua',
                'meadowgreen': 'Meadow Green'
            };
            
            if (colorScheme) {
                // √Åp d·ª•ng m√†u cho t·∫•t c·∫£ c√°c d√≤ng ghi ch√∫
                const noteRows = document.querySelectorAll('tr[style*="background"]');
                noteRows.forEach(row => {
                    const firstCell = row.querySelector('td:first-child');
                    if (firstCell && firstCell.textContent.includes('üìù Ghi ch√∫')) {
                        // √Åp d·ª•ng m√†u cho d√≤ng ghi ch√∫
                        row.style.background = colorScheme.background;
                        
                        // √Åp d·ª•ng m√†u cho √¥ ƒë·∫ßu ti√™n (ti√™u ƒë·ªÅ ghi ch√∫)
                        firstCell.style.cssText = `background: ${colorScheme.background}; color: ${colorScheme.textColor}; padding: 8px; text-align: center; font-size: 12px; font-weight: 500; border: 1px solid ${colorScheme.borderColor};`;
                        
                        // √Åp d·ª•ng m√†u cho t·∫•t c·∫£ c√°c √¥ ghi ch√∫ trong d√≤ng n√†y
                        const noteCells = row.querySelectorAll('.note-cell');
                        noteCells.forEach(cell => {
                            cell.style.background = colorScheme.background;
                            cell.style.border = `1px solid ${colorScheme.borderColor}`;
                            
                            // C·∫≠p nh·∫≠t m√†u cho textarea trong √¥ ghi ch√∫
                            const textarea = cell.querySelector('textarea');
                            if (textarea) {
                                textarea.style.background = colorScheme.background;
                                textarea.style.color = colorScheme.textColor;
                                textarea.style.border = `1px solid ${colorScheme.borderColor}`;
                            }
                        });
                    }
                });
                
                // L∆∞u m√†u ghi ch√∫ ƒë√£ ch·ªçn
                localStorage.setItem('noteColor', selectedColor);
                
                showNotification(`ƒê√£ √°p d·ª•ng m√†u ${colorNames[selectedColor]} cho ghi ch√∫! üìù`);
            }
        }

        // Reset v·ªÅ m√†u m·∫∑c ƒë·ªãnh (Meadow Green)
        function resetToDefault() {
            // Reset header v·ªÅ m√†u Meadow Green m·∫∑c ƒë·ªãnh
            const headerRow = document.querySelector('thead tr');
            if (headerRow) {
                headerRow.style.cssText = 'background: #d1fae5; color: #065f46; font-weight: bold;';
            }
            
            // Reset t·∫•t c·∫£ √¥ th·ªùi gian v·ªÅ m√†u Meadow Green nh·∫°t
            const timeCells = document.querySelectorAll('tbody td:first-child');
            timeCells.forEach(cell => {
                if (cell.textContent.includes('Ti·∫øt') || cell.classList.contains('time-cell')) {
                    cell.style.cssText = 'background: #ecfdf5; color: #065f46; padding: 12px; font-weight: bold; text-align: center;';
                }
            });
            
            // Reset t·∫•t c·∫£ c√°c d√≤ng ghi ch√∫ v·ªÅ m√†u m·∫∑c ƒë·ªãnh
            const noteRows = document.querySelectorAll('tr[style*="background"]');
            noteRows.forEach(row => {
                const firstCell = row.querySelector('td:first-child');
                if (firstCell && firstCell.textContent.includes('üìù Ghi ch√∫')) {
                    // Reset m√†u d√≤ng ghi ch√∫ v·ªÅ m√†u g·ªëc
                    row.style.cssText = row.style.cssText.replace(/background[^;]*;?/g, '');
                    
                    // Reset √¥ ti√™u ƒë·ªÅ ghi ch√∫
                    const originalClasses = firstCell.className;
                    firstCell.style.cssText = '';
                    firstCell.className = originalClasses;
                    
                    // Reset t·∫•t c·∫£ c√°c √¥ ghi ch√∫ trong d√≤ng n√†y
                    const noteCells = row.querySelectorAll('.note-cell');
                    noteCells.forEach(cell => {
                        cell.style.background = 'white';
                        cell.style.border = '';
                        
                        // Reset textarea trong √¥ ghi ch√∫
                        const textarea = cell.querySelector('textarea');
                        if (textarea) {
                            textarea.style.background = 'white';
                            textarea.style.color = '';
                            textarea.style.border = '1px solid #e5e7eb';
                        }
                    });
                }
            });
            
            // ƒê·∫∑t t·∫•t c·∫£ √¥ n·ªôi dung v·ªÅ m√†u tr·∫Øng
            const contentCells = document.querySelectorAll('.schedule-cell, .note-cell');
            contentCells.forEach(cell => {
                cell.style.background = 'white';
                cell.dataset.cellColor = 'white';
            });
            
            // Reset ch·∫ø ƒë·ªô ch·ªçn m√†u
            selectedColor = null;
            
            // Reset hi·ªÉn th·ªã
            document.getElementById('selectedColorInfo').textContent = 'Ch∆∞a ch·ªçn m√†u n√†o';
            document.querySelectorAll('.color-option div').forEach(div => {
                div.style.transform = 'scale(1)';
                div.style.boxShadow = 'none';
            });
            
            // X√≥a m√†u ƒë√£ l∆∞u
            localStorage.removeItem('headerColor');
            localStorage.removeItem('noteColor');
            
            showNotification('ƒê√£ reset v·ªÅ m√†u m·∫∑c ƒë·ªãnh! üîÑ');
        }

        // Kh·ªüi t·∫°o c√°c √¥ nh·∫≠p li·ªáu
        function initializeSchedule() {
            const cells = document.querySelectorAll('.schedule-cell');
            cells.forEach(cell => {
                const period = cell.dataset.period;
                const day = cell.dataset.day;
                
                cell.innerHTML = `
                    <div class="space-y-1">
                        <input type="text" 
                               placeholder="M√¥n h·ªçc" 
                               class="w-full p-2 text-sm border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-300 focus:border-transparent bg-white"
                               data-field="subject"
                               id="subject-${period}-${day}">
                        <input type="text" 
                               placeholder="Gi√°o vi√™n" 
                               class="w-full p-1 text-xs border border-gray-200 rounded focus:ring-1 focus:ring-blue-300 focus:border-transparent bg-gray-50"
                               data-field="teacher"
                               id="teacher-${period}-${day}">
                        <input type="text" 
                               placeholder="Ph√≤ng h·ªçc" 
                               class="w-full p-1 text-xs border border-gray-200 rounded focus:ring-1 focus:ring-blue-300 focus:border-transparent bg-gray-50"
                               data-field="location"
                               id="location-${period}-${day}">
                    </div>
                `;
                
                // ƒê·∫∑t m√†u n·ªÅn tr·∫Øng cho t·∫•t c·∫£ √¥ n·ªôi dung
                cell.style.background = 'white';
            });
            
            // Kh·ªüi t·∫°o c√°c √¥ ghi ch√∫
            const noteCells = document.querySelectorAll('.note-cell');
            noteCells.forEach(cell => {
                const note = cell.dataset.note;
                const day = cell.dataset.day;
                
                cell.innerHTML = `
                    <div class="space-y-1">
                        <textarea placeholder="Ghi ch√∫..." 
                                  class="w-full p-1 text-xs border border-gray-200 rounded focus:ring-1 focus:ring-blue-300 focus:border-transparent bg-white resize-none"
                                  rows="2"
                                  data-field="note"
                                  id="note-${note}-${day}"
                                  onchange="updateNoteDisplay(this)"></textarea>
                        <div class="note-items" id="items-${note}-${day}"></div>
                    </div>
                `;
            });
            
            // T·∫£i d·ªØ li·ªáu ƒë√£ l∆∞u
            loadSchedule();
        }

        // L∆∞u th·ªùi kh√≥a bi·ªÉu (c·∫≠p nh·∫≠t ƒë·ªÉ l∆∞u m√†u)
        function saveSchedule() {
            const scheduleData = {};
            
            // L∆∞u d·ªØ li·ªáu c√°c ti·∫øt h·ªçc
            const cells = document.querySelectorAll('.schedule-cell');
            cells.forEach(cell => {
                const period = cell.dataset.period;
                const day = cell.dataset.day;
                const key = `${period}-${day}`;
                
                const subject = cell.querySelector('[data-field="subject"]').value;
                const teacher = cell.querySelector('[data-field="teacher"]').value;
                const location = cell.querySelector('[data-field="location"]').value;
                const cellColor = cell.dataset.cellColor || 'default';
                
                scheduleData[key] = {
                    subject: subject,
                    teacher: teacher,
                    location: location,
                    color: cellColor
                };
            });
            
            // L∆∞u d·ªØ li·ªáu ghi ch√∫
            const noteCells = document.querySelectorAll('.note-cell');
            noteCells.forEach(cell => {
                const note = cell.dataset.note;
                const day = cell.dataset.day;
                const key = `${note}-${day}`;
                
                const noteText = cell.querySelector('[data-field="note"]').value;
                
                scheduleData[key] = {
                    note: noteText
                };
            });
            
            // L∆∞u th·ªùi gian t√πy ch·ªânh cho bu·ªïi t·ªëi
            const timeCells = document.querySelectorAll('.time-cell');
            timeCells.forEach(cell => {
                const period = cell.dataset.period;
                const timeInput = cell.querySelector('[data-field="time"]');
                if (timeInput) {
                    scheduleData[`time-${period}`] = {
                        time: timeInput.value
                    };
                }
            });
            
            localStorage.setItem('scheduleData', JSON.stringify(scheduleData));
            showNotification('ƒê√£ l∆∞u! ‚ú®');
        }

        // T·∫£i th·ªùi kh√≥a bi·ªÉu ƒë√£ l∆∞u
        function loadSchedule() {
            const savedData = localStorage.getItem('scheduleData');
            if (savedData) {
                const scheduleData = JSON.parse(savedData);
                
                Object.keys(scheduleData).forEach(key => {
                    const data = scheduleData[key];
                    
                    if (key.includes('note-')) {
                        // T·∫£i ghi ch√∫
                        const noteInput = document.getElementById(key);
                        if (noteInput) {
                            noteInput.value = data.note || '';
                            updateNoteDisplay(noteInput);
                        }
                    } else if (key.startsWith('time-')) {
                        // T·∫£i th·ªùi gian t√πy ch·ªânh
                        const timeInput = document.getElementById(key);
                        if (timeInput) {
                            timeInput.value = data.time || '';
                        }
                    } else {
                        // T·∫£i d·ªØ li·ªáu ti·∫øt h·ªçc
                        const [period, day] = key.split('-');
                        
                        const subjectInput = document.getElementById(`subject-${period}-${day}`);
                        const teacherInput = document.getElementById(`teacher-${period}-${day}`);
                        const locationInput = document.getElementById(`location-${period}-${day}`);
                        
                        if (subjectInput) subjectInput.value = data.subject || '';
                        if (teacherInput) teacherInput.value = data.teacher || '';
                        if (locationInput) locationInput.value = data.location || '';
                    }
                });
            }
            
            // T·∫£i m√†u header ƒë√£ l∆∞u
            const savedHeaderColor = localStorage.getItem('headerColor');
            if (savedHeaderColor) {
                const colorScheme = headerColorSchemes[savedHeaderColor];
                if (colorScheme) {
                    // √Åp d·ª•ng m√†u cho header
                    const headerRow = document.querySelector('thead tr');
                    if (headerRow) {
                        headerRow.style.cssText = colorScheme.header + ` color: ${colorScheme.textColor}; font-weight: bold;`;
                    }
                    
                    // √Åp d·ª•ng m√†u cho c√°c √¥ th·ªùi gian
                    const timeCells = document.querySelectorAll('tbody td:first-child');
                    timeCells.forEach(cell => {
                        if (cell.textContent.includes('Ti·∫øt') || cell.textContent.includes('Ra ch∆°i') || cell.classList.contains('time-cell')) {
                            cell.style.cssText = colorScheme.timeCell + ` color: ${colorScheme.textColor}; padding: 12px; font-weight: bold; text-align: center;`;
                        }
                    });
                }
            }

            // T·∫£i m√†u ghi ch√∫ ƒë√£ l∆∞u
            const savedNoteColor = localStorage.getItem('noteColor');
            if (savedNoteColor) {
                const colorScheme = noteColorSchemes[savedNoteColor];
                if (colorScheme) {
                    // √Åp d·ª•ng m√†u cho t·∫•t c·∫£ c√°c d√≤ng ghi ch√∫
                    const noteRows = document.querySelectorAll('tr[style*="background"]');
                    noteRows.forEach(row => {
                        const firstCell = row.querySelector('td:first-child');
                        if (firstCell && firstCell.textContent.includes('üìù Ghi ch√∫')) {
                            // √Åp d·ª•ng m√†u cho d√≤ng ghi ch√∫
                            row.style.background = colorScheme.background;
                            
                            // √Åp d·ª•ng m√†u cho √¥ ƒë·∫ßu ti√™n (ti√™u ƒë·ªÅ ghi ch√∫)
                            firstCell.style.cssText = `background: ${colorScheme.background}; color: ${colorScheme.textColor}; padding: 8px; text-align: center; font-size: 12px; font-weight: 500; border: 1px solid ${colorScheme.borderColor};`;
                            
                            // √Åp d·ª•ng m√†u cho t·∫•t c·∫£ c√°c √¥ ghi ch√∫ trong d√≤ng n√†y
                            const noteCells = row.querySelectorAll('.note-cell');
                            noteCells.forEach(cell => {
                                cell.style.background = colorScheme.background;
                                cell.style.border = `1px solid ${colorScheme.borderColor}`;
                                
                                // C·∫≠p nh·∫≠t m√†u cho textarea trong √¥ ghi ch√∫
                                const textarea = cell.querySelector('textarea');
                                if (textarea) {
                                    textarea.style.background = colorScheme.background;
                                    textarea.style.color = colorScheme.textColor;
                                    textarea.style.border = `1px solid ${colorScheme.borderColor}`;
                                }
                            });
                        }
                    });
                }
            }
            
            // ƒê·∫£m b·∫£o t·∫•t c·∫£ √¥ n·ªôi dung lu√¥n c√≥ m√†u tr·∫Øng
            const contentCells = document.querySelectorAll('.schedule-cell, .note-cell');
            contentCells.forEach(cell => {
                if (!cell.style.background || cell.style.background === '') {
                    cell.style.background = 'white';
                }
            });
        }

        // Th√™m CSS animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(-10px); }
                to { opacity: 1; transform: translateY(0); }
            }
            
            .schedule-cell {
                transition: all 0.3s ease;
            }
            
            .schedule-cell:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            }
            
            .color-option div {
                transition: all 0.2s ease;
            }
        `;
        document.head.appendChild(style);

        // Kh·ªüi t·∫°o ·ª©ng d·ª•ng
        document.addEventListener('DOMContentLoaded', function() {
            initializeSchedule();
            setupAutoSave();
            
            // Th√™m event listener ƒë·ªÉ tho√°t ch·∫ø ƒë·ªô ch·ªçn m√†u khi nh·∫•n ESC
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && colorMode) {
                    selectedColor = null;
                    colorMode = false;
                    document.body.style.cursor = 'default';
                    document.getElementById('selectedColorInfo').textContent = 'Ch∆∞a ch·ªçn m√†u n√†o';
                    document.querySelectorAll('.color-option div').forEach(div => {
                        div.style.transform = 'scale(1)';
                        div.style.boxShadow = 'none';
                    });
                    showNotification('ƒê√£ tho√°t ch·∫ø ƒë·ªô ch·ªçn m√†u');
                }
            });
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'990cd21145b19626',t:'MTc2MDg0MDY4MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>

